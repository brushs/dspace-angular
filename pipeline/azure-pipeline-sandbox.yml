# Docker
# Build and push an image to Azure Container Registry
# https://docs.microsoft.com/azure/devops/pipelines/languages/docker

trigger:
- oir-sandbox

resources:
- repo: self

variables:
  # Container registry service connection established during pipeline creation
  dockerRegistryServiceConnection: $(DOCKER_REG_SERVICE_CONNECTION)
  imageRepository: $(IMAGE_REPOSITORY)
  containerRegistry: $(CONTAINER_REGISTRY)
  dockerfilePath: '$(Build.SourcesDirectory)/Dockerfile-sandbox'
  tag: '$(Build.BuildId)'
  azureSubscription: $(AZURE_SUBSCRIPTION)
  appName: $(APP_NAME)

  # Agent VM image name
  vmImageName: 'ubuntu-latest'

stages:
- template: azure-pipeline-stages.yml
